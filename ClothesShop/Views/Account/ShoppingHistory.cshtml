
@model IEnumerable<ClothesShop.Models.EF.Order>
@{
    ViewBag.Title = "Lịch sử mua hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .QmO3Bu {
        background: #fff;
        border-top-left-radius: 2px;
        border-top-right-radius: 2px;
        display: flex;
        margin-bottom: 12px;
        overflow: hidden;
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        width: 100%;
        /*z-index: 10;*/
    }

    h1.a11y-hidden, h2.a11y-hidden, h3.a11y-hidden {
        height: 1px;
        left: -9999px;
        overflow: hidden;
        position: absolute;
        width: 1px;
    }

    mRVNLm {
        color: #ee4d2d;
    }

    .KI5har {
        align-items: center;
        background: #fff;
        border-bottom: 2px solid rgba(0, 0, 0, .09);
        color: rgba(0, 0, 0, .8);
        cursor: pointer;
        display: flex;
        flex: 1;
        font-size: 16px;
        justify-content: center;
        line-height: 19px;
        overflow: hidden;
        padding: 16px 0;
        text-align: center;
        transition: color .2s;
        -webkit-user-select: none;
        -moz-user-select: none;
        /*user-select: none;*/
    }
</style>
<div style="height:150px;" class="remove"></div>
<section id="order-content">
    @using (Html.BeginForm("ShoppingHistory", "Account", FormMethod.Get, new { enctype = "multipart/form-data", @class = "form-inline d-flex justify-content-between" }))
    {
        var strSearch = ViewBag.stringSearch
    ? "<div class='form-group mb-2 col-10'><input name='SearchText' value='' id='SearchText' type='text' class='form-control' placeholder='Tìm kiếm theo mã đơn hàng hoặc tên sản phẩm' style='width: 100%;'></div><div class='form-group mb-2 ml-2'><button type='submit' class='btn btn-primary'>Tìm kiếm</button></div>"
    : "<div></div>";

        @Html.Raw(strSearch)
        <section class="QmO3Bu" aria-role="tablist">
            <h2 class="a11y-hidden"></h2>
            <a href="/Account/ShoppingHistory?Searchtext=&type=all" class="KI5har mRVNLm tab-link active btnOrder" data-id="all" title="Tất cả" aria-role="tab" aria-selected="true" aria-controls="olp_panel_id-0.08896883105868847">
                <span class="NoH9rC">Tất cả</span>
            </a>
            <a href="/Account/ShoppingHistory?Searchtext=&type=isVerified" class="KI5har tab-link btnOrder" data-id="isVerified" title="Đã đi đơn" aria-role="tab" aria-selected="false" aria-controls="olp_panel_id-0.5641504579440175">
                <span class="NoH9rC">Đã đi đơn</span>
            </a>
            <a href="/Account/ShoppingHistory?Searchtext=&type=isPaid" class="KI5har tab-link btnOrder" data-id="isPaid" title="Hoàn thành" aria-role="tab" aria-selected="false" aria-controls="olp_panel_id-0.8466887306709114">
                <span class="NoH9rC">Hoàn thành</span>
            </a>
        </section>

    }
    @if (Model != null && Model.Any())
    {
        foreach (var order in Model)
        {
            <div class="order-card mt-3 p-3 border">
                <h4><a href="/Account/OrderDetail/@order.Id" style="color: black">Đơn Hàng: @order.Id</a></h4>
                @foreach (var od in order.OrderDetails)
                {
                    var money = od.Quantity * od.Price;
                    var imgUrl = od.VariantSize.ProductVariant.ImageLists.FirstOrDefault(x => x.IsDefault)?.ImageUrl;
                    <div class="media row ">
                        <img src="@imgUrl" class="mr-3 col-2" style="width: 100px;">
                        <div class="media-body col-8">
                            <a href="/Product/Detail/@od.VariantSize.ProductVariant.Product.Id"><h5>@od.VariantSize.ProductVariant.Product.Title</h5></a>
                            <p>Màu: @od.VariantSize.ProductVariant.Color.Name</p>
                            <p>Kích cỡ: @od.VariantSize.Size.Name</p>
                            <p>Số lượng: @od.Quantity</p>
                        </div>
                        <div class="col-2"><p>Số tiền: @money</p></div>
                    </div>
                }
            </div>
        }
    }
    else
    {
        <p>Không có đơn hàng!!!</p>
    }
</section>

@section scripts{
    <script>
        $(document).ready(function () {
            $('.tab-link').click(function (event) {
                event.preventDefault();
                var type = $(this).data("id");
                var searchText = $('#SearchText').val();

                $.ajax({
                    url: '/Account/ShoppingHistory',
                    type: 'GET',
                    data: { SearchText: searchText, type: type },
                    success: function (response) {
                        $('.remove').remove();
                        $('#order-content').html(response);
                    },
                    error: function (error) {
                        console.error("Error:", error);
                    }
                });
            });
        });
    </script>
}